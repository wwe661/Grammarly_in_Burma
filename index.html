<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      id="favicon"
      rel="icon"
      href="Logo&Pics/mainlogo.png"
      type="image/png"
    />
    <title>Grammarly In Burma</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="user">
    <header>
      <div class="logo-wrap">
        <span class="logo-text">Grammarly In Burma</span>
        <img
          id="logo"
          src="Logo&Pics/mainlogo.png"
          alt="Grammerly In Burma"
          class="logo-icon"
        />
      </div>
      <div class="mode-switch">
        <button id="userBtn" class="active" onclick="setMode('user')">
          User Mode
        </button>
        <button id="trainerBtn" onclick="setMode('trainer')">
          Trainer Mode
        </button>
      </div>
    </header>

    <div class="container">
      <!-- Input Panel -->
      <div class="panel">
        <textarea
          id="textInput"
          placeholder="မြန်မာစာကို ဒီမှာ ရိုက်ထည့်ပါ…"
        ></textarea>
        <div class="panel-footer">
          <button class="btn primary" onclick="checkText()">Submit</button>
          <button class="btn" onclick="pasteInput()">Paste</button>
          <button class="btn" onclick="clearInput()">Clear</button>
        </div>
      </div>

      <!-- Wall -->
      <div class="wall">
        <div class="particles"></div>
        <div class="credentials">
          <h3>Trainer Access</h3>
          <input type="text" id="trainerUser" placeholder="Username" />
          <input type="password" id="trainerPass" placeholder="Password" />
          <button
            class="btn primary"
            style="padding: 14px; font-size: 15px"
            onclick="trainerLogin()"
          >
            Unlock
          </button>
        </div>
      </div>

      <!-- Output Panel -->
      <div class="panel">
        <div id="result" class="output">Output will appear here…</div>
        <div class="panel-footer">
          <button class="btn primary" onclick="copyResult()">Copy</button>
          <button class="btn" onclick="downloadResult()">Download</button>
          <button class="btn" onclick="clearResult()">Reset</button>
        </div>
      </div>
    </div>

    <script>
      async function checkText() {
        animateWall();

        console.log("Sending mode :" + sending_mode);

        const text = document.getElementById("textInput").value;
        console.log("Input text:", text);
        const url = "http://127.0.0.1:8000/checkfrom" + sending_mode;
        console.log("Request URL:", url);
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text }),
        });

        const data = await response.json();

        console.log("Flags received:", data.flags);

        let newtext = "";

        for (const flag of data.flags) {
          const { start, end, message, color } = flag;
          console.log(message);
          // keep untouched text before the error
          //   newtext += text.slice(lastIndex, start);

          newtext += `<span class="underlined"
         style = "color: ${color}; text-decoration: underline ${color} wavy;">
         ${message}<p class="message">${message}</p></span>`;
        }
        // keep remaining text after last flag
        // newtext += text.slice(lastIndex);

        document.getElementById("result").innerHTML = newtext;
      }
    </script>
    <script src="script.js"></script>
  </body>
</html>
